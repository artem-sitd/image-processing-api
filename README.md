# Апи для клонирования изображений в разные размеры

> Проект выполнен в рамках тестового задания, требования указаны в `ТЗ.md`

## Установка:
 
1. Клонирование репозитория

> git clone https://github.com/artem-sitd/image-processing-api.git

1.1 Редактирование переменных окружения:
необходимо переименовать файл `.env.docker.template` в `.env.docker` (**можете его не редактировать, но вот пояснения
для каждой переменной**)
> `POSTGRES_USER`- имя пользователя базы postgres, которую создаст докер контейнер \
`POSTGRES_PASSWORD` - пароль пользователя базы postgres, которую создаст докер контейнер \
`POSTGRES_HOST` - название контейнера postgres\
`POSTGRES_DB` - название базы, которую создаст контейнер postgres\
`access_key` - ключ для S3 minio, указываем просто как minio\
`secret_key` - секретный ключ для S3 minio, указываем просто как minio\
`endpoint` - путь до контейнера с S3 minio\

2. Сборка и запуск докер контейнеров

> docker-compose up --build

3. После сборки и запуска всех контейнеров - Можно пользоваться приложением.

## Использование

API предоставляет следующие конечные точки:

- `POST /upload_image` - отправка изображения.
- `GET /projects/{project_id}` - получение статуса обработки изображений, ссылок на версии изображений.

Документация API находится по адресу `localhost:8000/docs`

## Структура проекта

- `main.py` - основной файл приложения FastAPI.
- `app/models.py` - описание моделей SQLAlchemy.
- `app/schemas.py` - описание Pydantic схем.
- `app/crud.py` - функции для взаимодействия с базой данных.
- `app/processing.py` - функции для обработки изображений
- `alembic/` - настройки для миграций базы данных.
- `settings.py` - настройки для подключения к postgres, S3 minio, менеджер для Websocket

## Функционал проекта:

Я немного отошел от требований ТЗ, в данный момент работа осуществляется следующим образом:\
на эндпойнт `/upload_image` отправляется post запрос в form-data с передачей параметров в body: project_id: int, и file:File
Далее функция "create_upload_link" из app/crud.py отправляет картинку в S3 minio и получает ссылку на оригинальную 
картинку, далее создается запись в postgres, далее отправляется фоновая задача на клонирование картинки с разными 
размерами, которые в свою очередь также отправляются в S3 minio (получая обратно ссылки на каждый размер) 
у каждой картинки забираем ссылку и добавляем в postgres.
Перейдя на `GET /projects/{project_id}` - можно в онлайн режиме видеть как формируются ссылки на все размеры картинки